<div class="room-management user-management-card">
  <h2>Qu·∫£n l√Ω ph√≤ng</h2>

  <!-- Controls -->
  <div class="room-controls" style="display: flex; align-items: center; gap: 8px">
       <div
      class="form-floating form-floating-custom mb-3"
      style="position: relative; flex: 1"
    >
      <input
        type="email"
        class="form-control"
        id="floatingInput"
        placeholder="name@example.com"
        style="width: 100%; padding-right: 30px"
        [(ngModel)]="searchKeyword"
        (keyup.enter)="onSearch()"
      />
      <label for="floatingInput">T√¨m ki·∫øm</label>
    </div>
    <button class="add-room" (click)="openAddPopup()">+ Th√™m Ph√≤ng</button>
  </div>

  <!-- üßπ Thanh l·ªçc  -->
  <div class="filter-bar">
    <!-- L·ªçc tr·∫°ng th√°i ph√≤ng -->
    <div>
      <label for="roomStatus">Tr·∫°ng th√°i ph√≤ng:</label>
      <select
        id="roomStatus"
        [(ngModel)]="filter.room_status_id"
        (change)="filterRooms()"
      >
        <option value="">T·∫•t c·∫£</option>
        <option *ngFor="let status of roomStatuses" [value]="status._id">
          {{ status.name }}
        </option>
      </select>
    </div>
    <!-- L·ªçc lo·∫°i ph√≤ng -->
    <div>
      <label for="room-class">Lo·∫°i ph√≤ng:</label>
      <select
        id="room-class"
        [(ngModel)]="filter.room_class_id"
        (change)="filterRooms()"
      >
        <option value="">T·∫•t c·∫£</option>
        <option *ngFor="let roomClass of roomClasses" [value]="roomClass._id">
          {{ roomClass.name }}
        </option>
      </select>
    </div>

    <!-- Ng√†y nh·∫≠n -->
    <div>
      <label>Ng√†y nh·∫≠n:</label>
      <input
        type="date"
        [(ngModel)]="filter.check_in_date"
        (change)="filterByDate()"
      />
    </div>

    <!-- Ng√†y tr·∫£ -->
    <div>
      <label>Ng√†y tr·∫£:</label>
      <input
        type="date"
        [(ngModel)]="filter.check_out_date"
        (change)="filterByDate()"
      />
    </div>

    <!-- N√∫t l·ªçc theo ng√†y -->
    <!-- <button (click)="filterByDate()">L·ªçc ph√≤ng tr·ªëng</button> -->
  </div>

  <!-- popup th√™m ph√≤ng -->
  <div class="popup-add-popup" *ngIf="isAddRoomPopupOpen">
    <div class="popup-content">
      <h2>Th√™m ph√≤ng</h2>

      <form (ngSubmit)="onAddRoomSubmit()" #addRoomForm="ngForm">
        <!-- T√™n ph√≤ng -->
        <div class="popup-section">
          <label for="name">T√™n ph√≤ng:</label>
          <input
            type="text"
            id="name"
            name="name"
            [(ngModel)]="newRoom.name"
            required
          />
        </div>

        <!-- T·∫ßng -->
        <div class="popup-section">
          <label for="floor">T·∫ßng:</label>
          <input
            type="text"
            id="floor"
            name="floor"
            [(ngModel)]="newRoom.floor"
            required
          />
        </div>
        <!-- tr·∫°ng th√°i ph√≤ng -->
        <div class="popup-section">
          <label>Tr·∫°ng th√°i ph√≤ng</label>
          <select [(ngModel)]="newRoom.room_status_id" name="room_status">
            <option *ngFor="let status of roomStatuses" [value]="status._id">
              {{ status.name }}
            </option>
          </select>
        </div>
        <!-- Ch·ªçn lo·∫°i ph√≤ng -->
        <div class="popup-section">
          <label for="roomClass">Lo·∫°i ph√≤ng:</label>
          <select
            id="roomClass"
            name="roomClass"
            [(ngModel)]="newRoom.room_class_id"
            (change)="onRoomClassChange(newRoom.room_class_id)"
            required
          >
            <option *ngFor="let rc of roomClasses" [value]="rc._id">
              {{ rc.name }}
            </option>
          </select>
        </div>

        <!-- T·ª± hi·ªÉn th·ªã th√¥ng tin lo·∫°i ph√≤ng -->
        <div *ngIf="selectedRoomClassInfo">
          <div class="popup-section">
            <label for="bed_amount">S·ªë gi∆∞·ªùng:</label>
            <input
              type="text"
              id="bed_amount"
              [value]="selectedRoomClassInfo.bed_amount"
              readonly
            />
          </div>

          <div class="popup-section">
            <label for="price">Gi√°:</label>
            <input
              type="text"
              id="price"
              [value]="selectedRoomClassInfo.price | currency : 'VND'"
              readonly
            />
          </div>

          <div class="popup-section">
            <label for="description">M√¥ t·∫£:</label>
            <textarea
              id="description"
              [value]="selectedRoomClassInfo.description"
              readonly
            ></textarea>
          </div>
        </div>

        <div class="popup-actions">
          <button type="submit" [disabled]="!addRoomForm.form.valid">
            L∆∞u
          </button>
          <button type="button" (click)="closeAddRoomPopup()">H·ªßy</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Table Header -->
  <div class="table-header">
    <div>STT</div>
    <div>T√™n ph√≤ng</div>
    <div>T·∫ßng</div>
    <div>T√™n lo·∫°i ph√≤ng</div>
    <div>Tr·∫°ng th√°i</div>
    <div>S·ªë gi∆∞·ªùng</div>
    <div>Gi√°</div>
    <!-- <div>M√¥ t·∫£</div> -->
    <!-- <div>Ti·ªán nghi</div> -->
    <div>H√†nh ƒë·ªông</div>
  </div>

  <!-- Table Rows -->
  <div class="table-row" *ngFor="let room of filteredRooms; let i = index">
    <div>{{ i + 1 }}</div>
    <div (click)="viewRoomDetail(room)" style="cursor: pointer">
      {{ room.name }}
    </div>
    <div>{{ room.floor }}</div>
    <div>{{ room.room_class[0].name || "Kh√¥ng r√µ" }}</div>
    <div>{{ room.status[0].name || "Kh√¥ng r√µ" }}</div>
    <div>{{ room.room_class[0].bed_amount }}</div>
    <div>{{ room.room_class[0].price | currency : "VND" }}</div>
    <!-- <div>{{ room.room_class[0].description }}</div> -->
    <!-- <div>{{ getFeatureNames(room) }}</div> -->
    <div class="actions">
      <!-- Edit icon -->
      <button
        class="icon-button"
        (click)="editRoom(room); $event.stopPropagation()"
      >
        <i class="fas fa-pen"></i>
      </button>
    </div>
  </div>
  <!-- popup chi ti·∫øt -->
  <div class="popup-overlay" *ngIf="isRoomDetailOpen && selectedRoom">
    <div class="popup-content">
      <h2>Chi ti·∫øt ph√≤ng: {{ selectedRoom.name }}</h2>

      <label>L·ªãch ƒë·∫∑t ph√≤ng:</label>
      <full-calendar [options]="calendarOptions"></full-calendar>

      <div class="popup-section">
        <label>T√™n ph√≤ng:</label>
        <span>{{ selectedRoom.name || "Kh√¥ng r√µ" }}</span>
      </div>

      <div class="popup-section">
        <label>T·∫ßng:</label>
        <span>{{ selectedRoom.floor }}</span>
      </div>

      <div class="popup-section">
        <label>Tr·∫°ng th√°i:</label>
        <span>{{ selectedRoom.status[0]?.name }}</span>
      </div>

      <div class="popup-section">
        <label>M√¥ t·∫£:</label>
        <span>{{ selectedRoom.room_class[0]?.description }}</span>
      </div>

      <div class="popup-section">
        <label>S·ªë gi∆∞·ªùng:</label>
        <span>{{ selectedRoom.room_class[0]?.bed_amount }}</span>
      </div>

      <div class="popup-section">
        <label>T√™n lo·∫°i ph√≤ng:</label>
        <span>{{ selectedRoom.room_class[0]?.name }}</span>
      </div>

      <div class="popup-section">
        <label>Gi√°:</label>
        <span>{{
          selectedRoom.room_class[0]?.price | currency : "VND" : "symbol"
        }}</span>
      </div>

      <div class="popup-section">
        <label>Gi√° gi·∫£m:</label>
        <span>{{
          selectedRoom.room_class[0]?.price_discount
            | currency : "VND" : "symbol"
        }}</span>
      </div>

      <div class="popup-section">
        <label>S·ª©c ch·ª©a:</label>
        <span>{{ selectedRoom.room_class[0]?.capacity }} ng∆∞·ªùi</span>
      </div>

      <button class="close-btn" (click)="isRoomDetailOpen = false">ƒê√≥ng</button>
    </div>
  </div>

  <!-- popup s·ª≠a ph√≤ng -->
  <div class="popup-add-popup" *ngIf="isEditRoomPopupOpen">
    <div class="popup-content">
      <h2>S·ª≠a ph√≤ng</h2>

      <form (ngSubmit)="onEditRoomSubmit()" #editRoomForm="ngForm">
        <!-- T√™n ph√≤ng -->
        <div class="popup-section">
          <label for="editName">T√™n ph√≤ng:</label>
          <input
            type="text"
            id="editName"
            name="editName"
            [(ngModel)]="editRoomData.name"
            required
          />
        </div>

        <!-- T·∫ßng -->
        <div class="popup-section">
          <label for="editFloor">T·∫ßng:</label>
          <input
            type="number"
            id="editFloor"
            name="editFloor"
            [(ngModel)]="editRoomData.floor"
            required
            min="1"
          />
        </div>

        <!-- Ch·ªçn lo·∫°i ph√≤ng -->
        <div class="popup-section">
          <label for="editRoomClass">Lo·∫°i ph√≤ng:</label>
          <select
            id="editRoomClass"
            name="editRoomClass"
            [(ngModel)]="editRoomData.room_class_id"
            (change)="onEditRoomClassChange(editRoomData.room_class_id)"
            required
          >
            <option *ngFor="let rc of roomClasses" [value]="rc._id">
              {{ rc.name }}
            </option>
          </select>
        </div>

        <!-- T·ª± hi·ªÉn th·ªã th√¥ng tin lo·∫°i ph√≤ng -->
        <div *ngIf="selectedEditRoomClassInfo">
          <div class="popup-section">
            <label for="bed_amount">S·ªë gi∆∞·ªùng:</label>
            <input
              type="text"
              id="bed_amount"
              [value]="selectedEditRoomClassInfo.bed_amount"
              readonly
            />
          </div>

          <div class="popup-section">
            <label for="price">Gi√°:</label>
            <input
              type="text"
              id="price"
              [value]="selectedEditRoomClassInfo.price | currency : 'VND'"
              readonly
            />
          </div>

          <div class="popup-section">
            <label for="description">M√¥ t·∫£:</label>
            <textarea
              id="description"
              [value]="selectedEditRoomClassInfo.description"
              readonly
            ></textarea>
          </div>
        </div>

        <div class="popup-actions">
          <button type="submit" [disabled]="!editRoomForm.form.valid">
            L∆∞u
          </button>
          <button type="button" (click)="closeEditRoomPopup()">H·ªßy</button>
        </div>
      </form>
    </div>
  </div>
</div>
