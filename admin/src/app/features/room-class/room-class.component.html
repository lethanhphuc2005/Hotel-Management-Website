<div class="room-management user-management-card">
  <h2>Quản lý loại phòng</h2>

  <!-- Controls -->
  <div
    class="room-controls"
    style="display: flex; align-items: center; gap: 8px"
  >
    <div
      class="form-floating form-floating-custom mb-3"
      style="position: relative; flex: 1"
    >
      <input
        type="email"
        class="form-control"
        id="floatingInput"
        placeholder="name@example.com"
        style="width: 100%; padding-right: 30px"
        [(ngModel)]="filter.keyword"
        (ngModelChange)="onFilterChange()"
      />
      <label for="floatingInput">Tìm kiếm</label>
    </div>
    <button class="add-room" (click)="onOpenPopup(true)">
      + Thêm loại phòng
    </button>
  </div>
  <!-- Filter -->
  <div class="filter-bar">
    <div>
      <label for="statusFilter">Trạng thái:</label>
      <select
        id="statusFilter"
        class="form-select"
        [(ngModel)]="filter.status"
        (ngModelChange)="onFilterChange()"
      >
        <option value="">Tất cả</option>
        <option value="true">Kích hoạt</option>
        <option value="false">Không kích hoạt</option>
      </select>
    </div>
    <div>
      <label for="featureFilter">Tiện nghi:</label>
      <select
        id="featureFilter"
        class="form-select"
        [(ngModel)]="filter.feature"
        (ngModelChange)="onFilterChange()"
      >
        <option value="">Tất cả</option>
        <option *ngFor="let feature of features" [value]="feature.id">
          {{ feature.name }}
        </option>
      </select>
    </div>
    <div>
      <label for="mainRoomClassFilter">Loại phòng chính:</label>
      <select
        id="mainRoomClassFilter"
        class="form-select"
        [(ngModel)]="filter.type"
        (ngModelChange)="onFilterChange()"
      >
        <option value="">Tất cả</option>
        <option *ngFor="let mrc of mainRoomClasses" [value]="mrc.id">
          {{ mrc.name }}
        </option>
      </select>
    </div>
    <div>
      <label>Sắp xếp:</label>
      <button (click)="onFilterChange('status')">
        Trạng thái: {{ filter.sortOrder === "asc" ? "↑" : "↓" }}
      </button>
    </div>
  </div>

  <!-- Table Header -->
  <div class="table-header">
    <div>STT</div>
    <div>Tên</div>
    <div>
      Số giường <br />
      (Sức chứa)
    </div>
    <div>Giá</div>
    <div>Số phòng trống</div>
    <div>Tiện nghi</div>
    <div>Trạng thái</div>
    <div>Hành động</div>
  </div>

  <!-- Table Rows -->
  <app-room-class-list
    [roomClasses]="roomClasses"
    [filter]="filter"
    (openDetail)="onViewDetail($event)"
    (openEdit)="onOpenPopup(false, $event)"
    (toggleStatus)="onToggleChange($event.$event, $event.rc)"
  ></app-room-class-list>

  <!-- Pagination -->
  <app-pagination
    [page]="filter.page"
    [limit]="filter.limit"
    [total]="filter.total"
    (pageChange)="onPageChange($event)"
  />

  <!-- Popup chi tiết loại phòng -->
  <app-room-class-detail
    [isVisible]="isDetailPopupOpen"
    [roomClass]="selectedRoomClass"
    (closePopup)="onClosePopup()"
  ></app-room-class-detail>

  <!-- Thêm loại phòng -->
  <app-room-class-form
    *ngIf="isAddPopupOpen"
    [isEdit]="false"
    [formData]="newRoomClass"
    [features]="features"
    [mainRoomClasses]="mainRoomClasses"
    [imagePreview]="imagePreview"
    [selectedFeatureIds]="selectedFeatureIds"
    (close)="onClosePopup()"
    (formSubmit)="onAddRoomClass()"
    (fileSelected)="onFileSelected($event)"
    (removeImage)="removeImage($event.index, $event.event)"
    (featureToggle)="onFeatureToggle($event.id, $event.event)"
  ></app-room-class-form>

  <!-- Sửa loại phòng -->
  <app-room-class-form
    *ngIf="isEditPopupOpen && selectedRoomClass"
    [isEdit]="true"
    [formData]="selectedRoomClass"
    [features]="features"
    [mainRoomClasses]="mainRoomClasses"
    [imagePreview]="imagePreview"
    [selectedFeatureIds]="selectedFeatureIds"
    (close)="onClosePopup()"
    (formSubmit)="onEditRoomClass()"
    (fileSelected)="onFileSelected($event)"
    (removeImage)="removeImage($event.index, $event.event)"
    (featureToggle)="onFeatureToggle($event.id, $event.event)"
  ></app-room-class-form>
</div>
