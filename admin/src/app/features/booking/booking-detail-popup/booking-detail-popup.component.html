<div
  class="tw-fixed tw-inset-0 tw-bg-black/50 tw-flex tw-items-center tw-justify-center tw-z-50"
  *ngIf="visible && booking"
>
  <div
    class="tw-bg-white tw-rounded-2xl tw-shadow-2xl tw-w-full tw-max-w-5xl tw-p-6 tw-relative tw-animate-fadeIn tw-max-h-[85vh] tw-overflow-y-auto"
  >
    <h2 class="tw-text-2xl tw-font-bold tw-mb-6 tw-text-center tw-text-primary">
      üìã Chi ti·∫øt ƒë∆°n ƒë·∫∑t ph√≤ng
    </h2>

    <!-- TH√îNG TIN CHUNG -->
    <div
      class="tw-grid tw-grid-cols-1 md:tw-grid-cols-2 tw-gap-8 tw-text-sm tw-mb-8"
    >
      <!-- C·ªòT TR√ÅI -->
      <div class="tw-space-y-3">
        <p>
          <strong>M√£ ƒë∆°n:</strong>
          <span class="tw-text-blue-600">{{ booking.id }}</span>
        </p>

        <p>
          <strong>Nh√¢n vi√™n:</strong>
          <span *ngIf="booking.employee_id && booking.employee">
            {{ booking.employee.last_name }}
            {{ booking.employee.first_name }}
          </span>
          <span *ngIf="!booking.employee_id" class="tw-text-gray-500"
            >Ch∆∞a x√°c ƒë·ªãnh</span
          >
        </p>

        <p>
          <strong>Kh√°ch h√†ng:</strong><br />
          {{ booking.full_name }}<br />
          {{ booking.email }}<br />
          {{ booking.phone_number }}
        </p>

        <p>
          <strong>S·ªë kh√°ch:</strong>
          <span class="tw-text-green-600">
            {{ booking.adult_amount }} Ng∆∞·ªùi l·ªõn /
            {{ booking.child_amount }} Tr·∫ª em
          </span>
        </p>

        <p>
          <strong>Ph∆∞∆°ng th·ª©c ƒë·∫∑t:</strong>
          {{ booking.booking_method.name || "Ch∆∞a x√°c ƒë·ªãnh" }}
        </p>

        <p>
          <strong>Tr·∫°ng th√°i:</strong>
          <span class="tw-font-semibold">
            {{
              getBookingStatusName(booking.booking_status.code) ||
                "Ch∆∞a x√°c ƒë·ªãnh"
            }}
          </span>
          <span *ngIf="booking.cancel_date" class="tw-text-red-500">
            (H·ªßy: {{ booking.cancel_date | date : "dd/MM/yyyy" }} -
            {{ booking.cancel_reason || "Kh√¥ng r√µ l√Ω do" }})
          </span>
        </p>

        <p>
          <strong>Thanh to√°n:</strong>
          {{ getBookingPaymentStatusName(booking.payment_status) }}
        </p>

        <p>
          <strong>Ng√†y nh·∫≠n:</strong>
          {{ booking.check_in_date | date : "dd/MM/yyyy" }}<br />
          <strong>Ng√†y tr·∫£:</strong>
          {{ booking.check_out_date | date : "dd/MM/yyyy" }}
        </p>

        <p>
          <strong>Ng√†y ƒë·∫∑t:</strong>
          {{ booking.booking_date | date : "dd/MM/yyyy" }}
        </p>
        <p>
          <strong>Y√™u c·∫ßu:</strong> {{ booking.request || "Kh√¥ng c√≥ y√™u c·∫ßu" }}
        </p>
        <p>
          <strong>Ghi ch√∫:</strong> {{ booking.note || "Kh√¥ng c√≥ ghi ch√∫" }}
        </p>
      </div>

      <!-- C·ªòT PH·∫¢I -->
      <div class="tw-space-y-4">
        <div *ngIf="booking.actual_check_in_date">
          <h4 class="tw-font-bold tw-text-base tw-text-green-700">
            üè® Check-in
          </h4>
          <p>Ng√†y: {{ booking.actual_check_in_date | date : "dd/MM/yyyy" }}</p>
          <p>Gi·ªù: {{ booking.actual_check_in_date | date : "HH:mm" }}</p>
          <p>CMND/CCCD: {{ booking.check_in_identity?.number || "Ch∆∞a c√≥" }}</p>
          <p>
            Ng∆∞·ªùi ƒë·∫°i di·ªán:
            {{ booking.check_in_identity?.representative_name || "Ch∆∞a c√≥" }}
          </p>
        </div>

        <div *ngIf="booking.actual_check_out_date">
          <h4 class="tw-font-bold tw-text-base tw-text-yellow-600">
            üì§ Check-out
          </h4>
          <p>Ng√†y: {{ booking.actual_check_out_date | date : "dd/MM/yyyy" }}</p>
          <p>Gi·ªù: {{ booking.actual_check_out_date | date : "HH:mm" }}</p>
        </div>

        <div *ngIf="booking.payment && booking.payment.length > 0">
          <h4 class="tw-font-bold tw-text-base tw-text-blue-600">
            üí≥ Thanh to√°n
          </h4>
          <p>Ph∆∞∆°ng th·ª©c: {{ booking.payment[0].payment_method.name }}</p>
          <p>
            M√£ giao d·ªãch: {{ booking.payment[0].transaction_id || "Ch∆∞a c√≥" }}
          </p>
          <p>
            Ng√†y: {{ booking.payment[0].payment_date | date : "dd/MM/yyyy" }}
          </p>
          <p>
            Tr·∫°ng th√°i:
            {{
              getPaymentStatusName(booking.payment[0].status) || "Ch∆∞a x√°c ƒë·ªãnh"
            }}
          </p>
        </div>

        <div>
          <h4 class="tw-font-bold">üí∞ T·ªïng ti·ªÅn:</h4>
          <div *ngIf="booking.discount_value > 0">
            <span class="tw-text-green-600">
              {{ booking.total_price | currency : "VND" }}
            </span>
            <span class="tw-line-through tw-text-red-500 tw-ml-2">
              {{ booking.original_price | currency : "VND" }}
            </span>
          </div>
          <div *ngIf="booking.discount_value <= 0" class="tw-text-green-600">
            {{ booking.original_price | currency : "VND" }}
          </div>
        </div>

        <div *ngIf="booking.discount.length > 0">
          <h4 class="tw-font-bold">üéÅ Gi·∫£m gi√°:</h4>
          <ul class="tw-list-disc tw-pl-5 tw-text-sm">
            <li *ngFor="let discount of booking.discount">
              {{ discount.name }} - Gi·∫£m: {{ getDiscountText(discount) }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- DANH S√ÅCH PH√íNG -->
    <div class="tw-mt-6">
      <h3 class="tw-font-bold tw-text-lg tw-mb-2">üõèÔ∏è Danh s√°ch ph√≤ng</h3>
      <ul class="tw-divide-y tw-divide-gray-200">
        <li
          *ngFor="let detail of booking.booking_details"
          class="tw-py-3 tw-flex tw-flex-col md:tw-flex-row md:tw-items-center tw-gap-4"
        >
          <img
            *ngIf="detail.room_class_id"
            class="tw-w-16 tw-h-16 tw-rounded tw-object-cover"
            [src]="getImageUrl(detail.room_class_id.images?.[0]?.url)"
            [alt]="detail.room_class_id.name"
          />
          <div class="tw-flex-1">
            <p class="tw-font-medium">
              {{ detail.room?.[0]?.name || "(ch∆∞a g√°n)" }}
              <span class="tw-font-normal tw-text-gray-500">
                - {{ detail.room_class_id.name }}
              </span>
            </p>
            <p>
              Gi√°: {{ detail.price_per_night | currency : "VND" }} √ó
              {{ detail.nights }} ƒë√™m
            </p>
            <p *ngIf="detail.room?.[0]?.status?.[0]?.name">
              Tr·∫°ng th√°i: {{ detail.room?.[0]?.status?.[0]?.name }}
            </p>

            <!-- D·ªãch v·ª• -->
            <div *ngIf="detail.services?.length">
              <strong>D·ªãch v·ª•:</strong>
              <ul class="tw-list-disc tw-pl-5">
                <li *ngFor="let service of detail.services">
                  {{ service.service_id.name }} ({{
                    service.service_id.price | currency : "VND"
                  }})
                </li>
              </ul>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <!-- N√∫t ƒë√≥ng -->
    <button
      class="tw-w-full tw-bg-blue-500 hover:tw-bg-blue-600 tw-text-white tw-font-semibold tw-py-2 tw-mt-6 tw-rounded"
      (click)="onClose.emit()"
    >
      ƒê√≥ng
    </button>
  </div>
</div>
