<div class="roomtype-management-card">
  <h2>Qu·∫£n l√Ω lo·∫°i ph√≤ng ch√≠nh</h2>

  <div
    class="room-controls"
    style="display: flex; align-items: center; gap: 8px"
  >
    <div
      class="form-floating form-floating-custom mb-3"
      style="position: relative; flex: 1"
    >
      <input
        type="email"
        class="form-control"
        id="floatingInput"
        placeholder="name@example.com"
        style="width: 100%; padding-right: 30px"
        [(ngModel)]="searchKeyword"
        (keyup.enter)="onSearch()"
      />
      <label for="floatingInput">T√¨m ki·∫øm</label>
    </div>

    <button class="add-room" (click)="onAdd()">+ Th√™m lo·∫°i ph√≤ng ch√≠nh</button>
  </div>

  <!-- üßπ Thanh l·ªçc -->
  <div class="filter-bar">
    <!-- L·ªçc tr·∫°ng th√°i -->
    <div>
      <label for="status">Tr·∫°ng th√°i:</label>
      <select
        id="status"
        [(ngModel)]="statusFilterString"
        (change)="onStatusChange()"
      >
        <option value="">T·∫•t c·∫£</option>
        <option value="true">ƒêang ho·∫°t ƒë·ªông</option>
        <option value="false">V√¥ hi·ªáu h√≥a</option>
      </select>
    </div>

    <!-- N√∫t s·∫Øp x·∫øp theo tr·∫°ng th√°i -->
    <div>
      <label>S·∫Øp x·∫øp:</label>
      <button (click)="toggleSortOrder()">
        Tr·∫°ng th√°i: {{ sortOrder === "asc" ? "‚Üë" : "‚Üì" }}
      </button>
    </div>
  </div>

  <!-- Popup Th√™m lo·∫°i ph√≤ng ch√≠nh -->
  <div class="popup-add-popup" *ngIf="isAddPopupOpen">
    <div class="popup-content">
      <h2>Th√™m lo·∫°i ph√≤ng ch√≠nh</h2>

      <form (ngSubmit)="onAddSubmit()" #addForm="ngForm">
        <div class="popup-section">
          <div class="form-floating form-floating-custom mb-3">
            <input
              type="email"
              class="form-control"
              id="name"
              name="name"
              placeholder="name@example.com"
              [(ngModel)]="newMainRoom.name"
              required
            />
            <label for="name">T√™n lo·∫°i ph√≤ng ch√≠nh</label>
          </div>
        </div>

        <div class="popup-section">
          <label for="description">M√¥ t·∫£:</label>
          <textarea
            class="form-control mb-3"
            id="description"
            name="description"
            [(ngModel)]="newMainRoom.description"
          ></textarea>
        </div>

        <div class="popup-section">
          <label for="status">Tr·∫°ng th√°i:</label>
          <select
            id="status"
            name="status"
            class="form-select form-control mb-3"
            [(ngModel)]="newMainRoom.status"
          >
            <option [value]="true">ƒêang ho·∫°t ƒë·ªông</option>
            <option [value]="false">T·∫°m d·ª´ng ho·∫°t ƒë·ªông</option>
          </select>
        </div>

        <div class="popup-section">
          <label for="images">·∫¢nh (URL):</label>
          <input
            class="form-control mb-3"
            type="file"
            id="images"
            name="images"
            (change)="onFileSelected($event)"
          />
        </div>

        <div class="popup-actions">
          <button
            class="btn btn-success"
            type="submit"
            [disabled]="!addForm.form.valid"
          >
            L∆∞u
          </button>
          <button
            class="btn btn-danger"
            type="button"
            (click)="closeAddPopup()"
          >
            H·ªßy
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="table-header">
    <div>STT</div>
    <div>T√™n LPC</div>
    <!-- <div>M√¥ t·∫£</div> -->
    <div>H√¨nh ·∫£nh</div>
    <div>Lo·∫°i ph√≤ng con</div>
    <div>Tr·∫°ng th√°i</div>
    <div>H√†nh ƒë·ªông</div>
  </div>

  <div *ngFor="let rtm of mainRoomClasses; let i = index" class="table-row">
    <div>{{ i + 1 }}</div>
    <div (click)="onViewDetail(rtm)" style="cursor: pointer">
      {{ rtm.name }}
    </div>
    <!-- <div>{{ rtm.description }}</div> -->
    <div class="image-list">
      <img
        *ngFor="let img of rtm.images ?? []"
        [src]="'http://localhost:8000/images/' + img.url"
        alt="H√¨nh ·∫£nh"
        width="200"
      />
    </div>
    <div>
      <ul class="room-children-list">
        <li *ngFor="let rc of rtm.room_class_list">
          {{ rc.name }}
        </li>
      </ul>
    </div>
    <div class="status-column">
      <label class="switch">
        <input
          type="checkbox"
          [checked]="rtm.status"
          (change)="toggleMainRoomClass(rtm); $event.stopPropagation()"
        />
        <span class="slider"></span>
      </label>
    </div>
    <div class="actions">
      <button
        class="icon-button"
        (click)="onEdit(rtm); $event.stopPropagation()"
      >
        <i class="fas fa-pen"></i>
      </button>
    </div>
  </div>

  <!-- Popup chi ti·∫øt -->
  <div class="popup-overlay" *ngIf="isDetailPopupOpen && selectedMainRoom">
    <div class="popup-content">
      <h2>Chi ti·∫øt lo·∫°i ph√≤ng ch√≠nh</h2>

      <div class="popup-section">
        <label>T√™n:</label>
        <span>{{ selectedMainRoom.name }}</span>
      </div>

      <div class="popup-section">
        <label>M√¥ t·∫£:</label>
        <span>{{ selectedMainRoom.description }}</span>
      </div>

      <div class="popup-section">
        <label>Tr·∫°ng th√°i:</label>
        <span [ngClass]="selectedMainRoom.status ? 'active' : 'inactive'">
          {{
            selectedMainRoom.status ? "ƒêang ho·∫°t ƒë·ªông" : "T·∫°m d·ª´ng ho·∫°t ƒë·ªông"
          }}
        </span>
      </div>

      <div class="popup-section">
        <label>Lo·∫°i ph√≤ng con:</label>
        <ul>
          <li *ngFor="let rc of selectedMainRoom.room_class_list">
            {{ rc.name }}
          </li>
        </ul>
      </div>

      <div class="popup-section">
        <label>H√¨nh ·∫£nh:</label>
        <div class="image-list">
          <img
            *ngFor="let img of selectedMainRoom.images"
            [src]="'http://localhost:8000/' + img.url"
            alt="H√¨nh ·∫£nh"
            width="200"
          />
        </div>
      </div>

      <button class="close-btn" (click)="isDetailPopupOpen = false">
        ƒê√≥ng
      </button>
    </div>
  </div>
  <!-- Popup S·ª≠a lo·∫°i ph√≤ng ch√≠nh -->
  <div class="popup-add-popup" *ngIf="isEditPopupOpen">
    <div class="popup-content">
      <h2>S·ª≠a lo·∫°i ph√≤ng ch√≠nh</h2>

      <form (ngSubmit)="onEditSubmit()" #editForm="ngForm">
        <div class="popup-section">
          <div class="form-floating form-floating-custom mb-3">
            <input
              type="email"
              class="form-control"
              id="name"
              name="name"
              [(ngModel)]="editMainRoom.name"
              required
            />
            <label for="name">T√™n lo·∫°i ph√≤ng ch√≠nh</label>
          </div>
        </div>

        <div class="popup-section">
          <label for="description">M√¥ t·∫£:</label>
          <textarea
            class="form-control mb-3"
            id="description"
            name="description"
            [(ngModel)]="editMainRoom.description"
          ></textarea>
        </div>

        <!-- <div class="popup-section">
          <label for="status">Tr·∫°ng th√°i:</label>
          <select id="status" name="status" [(ngModel)]="editMainRoom.status">
            <option [ngValue]="true">ƒêang ho·∫°t ƒë·ªông</option>
            <option [ngValue]="false">T·∫°m d·ª´ng ho·∫°t ƒë·ªông</option>
          </select>
        </div> -->

        <div class="popup-section">
          <label for="editImage">·∫¢nh(Url):</label>
          <input
            type="file"
            id="editImage"
            class="form-control mb-3"
            (change)="onEditFileSelected($event)"
          />

          <!-- Hi·ªÉn th·ªã ·∫£nh preview -->
          <div class="col-6 col-sm-4">
            <label class="imagecheck mb-4">
              <input
                [(ngModel)]="isImageChecked"
                name="imagecheck"
                type="checkbox"
                value="2"
                class="imagecheck-input"
                checked=""
              />
              <figure class="imagecheck-figure">
                <img
                  [src]="editImageUrl"
                  alt="title"
                  class="imagecheck-image"
                />
              </figure>
            </label>
          </div>
        </div>

        <div class="popup-actions">
          <button class="btn btn-success" type="submit" [disabled]="!editForm.form.valid">L∆∞u</button>
          <button class="btn btn-danger" type="button" (click)="isEditPopupOpen = false">H·ªßy</button>
        </div>
      </form>
    </div>
  </div>
</div>
