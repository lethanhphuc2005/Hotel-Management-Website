<div class="room-management user-management-card">
  <h2>Qu·∫£n l√Ω ph√≤ng</h2>

  <!-- Controls -->
  <div
    class="room-controls"
    style="display: flex; align-items: center; gap: 8px"
  >
    <div
      class="form-floating form-floating-custom mb-3"
      style="position: relative; flex: 1"
    >
      <input
        type="email"
        class="form-control"
        id="floatingInput"
        placeholder="name@example.com"
        style="width: 100%; padding-right: 30px"
        [(ngModel)]="filter.keyword"
        (input)="onFilterChange()"
      />
      <label for="floatingInput">T√¨m ki·∫øm</label>
    </div>
    <button class="add-room" (click)="onOpenPopup(true)">+ Th√™m Ph√≤ng</button>
  </div>

  <!-- üßπ Thanh l·ªçc  -->
  <div class="filter-bar">
    <!-- L·ªçc lo·∫°i ph√≤ng -->
    <div>
      <label for="room-class">L·ªçc theo lo·∫°i ph√≤ng</label>
      <select
        name="room-class"
        [(ngModel)]="filter.type"
        (change)="onFilterChange()"
      >
        <option value="" selected>T·∫•t c·∫£ lo·∫°i ph√≤ng</option>
        <option *ngFor="let rc of roomClasses" [value]="rc.id">
          {{ rc.name }}
        </option>
      </select>
    </div>

    <!-- L·ªçc tr·∫°ng th√°i -->
    <div>
      <label for="status">L·ªçc theo tr·∫°ng th√°i</label>
      <select [(ngModel)]="filter.status" (change)="onFilterChange()">
        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option *ngFor="let status of roomStatuses" [value]="status.id">
          {{ status.name }}
        </option>
      </select>
    </div>

    <!-- Ng√†y nh·∫≠n/tr·∫£ -->
    <div>
      <label for="check-in">Ng√†y nh·∫≠n</label>
      <input
        type="date"
        [(ngModel)]="filter.check_in_date"
        (change)="onFilterChange()"
      />
    </div>

    <div>
      <label for="check-out">Ng√†y tr·∫£</label>
      <input
        type="date"
        [(ngModel)]="filter.check_out_date"
        (change)="onFilterChange()"
      />
    </div>
  </div>

  <!-- popup th√™m ph√≤ng -->
  <div class="popup-add-popup" *ngIf="isAddPopupOpen">
    <div class="popup-content">
      <h2>Th√™m ph√≤ng</h2>

      <form #addForm="ngForm" (ngSubmit)="onAddSubmit()">
        <div class="popup-section">
          <div class="form-floating form-floating-custom mb-3">
            <input
              type="email"
              class="form-control"
              id="name"
              name="name"
              placeholder="name@example.com"
              [(ngModel)]="newRoom.name"
              (ngModelChange)="newRoom.name = $event"
              required
            />
            <label for="name">T√™n ph√≤ng</label>
          </div>
        </div>

        <div class="popup-section">
          <div class="form-floating form-floating-custom mb-3">
            <input
              type="number"
              class="form-control"
              id="floor"
              name="floor"
              min="0"
              [(ngModel)]="newRoom.floor"
              (ngModelChange)="newRoom.floor = $event"
              required
            />
            <label for="floor">T·∫ßng</label>
          </div>
        </div>

        <div class="popup-section">
          <label for="room_class_id">Lo·∫°i ph√≤ng:</label>
          <select
            id="room_class_id"
            name="room_class_id"
            class="form-select form-control mb-3"
            [(ngModel)]="newRoom.room_class_id"
            (ngModelChange)="newRoom.room_class_id = $event"
            required
          >
            <option value="" disabled selected>Ch·ªçn lo·∫°i ph√≤ng</option>
            <option
              *ngFor="let roomClass of roomClasses"
              [value]="roomClass.id"
            >
              {{ roomClass.name }}
            </option>
          </select>
        </div>

        <div class="popup-section">
          <label for="room_status_id">Tr·∫°ng th√°i:</label>
          <select
            id="room_status_id"
            name="room_status_id"
            class="form-select form-control mb-3"
            [(ngModel)]="newRoom.room_status_id"
            (ngModelChange)="newRoom.room_status_id = $event"
          >
            <option value="" disabled selected>Ch·ªçn tr·∫°ng th√°i</option>
            <option *ngFor="let status of roomStatuses" [value]="status.id">
              {{ status.name }}
            </option>
          </select>
        </div>

        <div class="popup-actions">
          <button
            class="btn btn-success"
            type="submit"
            [disabled]="!addForm.form.valid"
          >
            L∆∞u
          </button>
          <button class="btn btn-danger" type="button" (click)="onClosePopup()">
            H·ªßy
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Table Header -->
  <div class="table-header">
    <div>STT</div>
    <div>T√™n ph√≤ng</div>
    <div>T·∫ßng</div>
    <div>T√™n lo·∫°i ph√≤ng</div>
    <div>Tr·∫°ng th√°i</div>
    <div>S·ªë gi∆∞·ªùng</div>
    <div>Gi√°</div>
    <!-- <div>M√¥ t·∫£</div> -->
    <!-- <div>Ti·ªán nghi</div> -->
    <div>H√†nh ƒë·ªông</div>
  </div>

  <!-- Table Rows -->
  <div class="table-row" *ngFor="let room of rooms; let i = index">
    <div>{{ i + 1 }}</div>
    <div (click)="onViewDetail($event, room)" style="cursor: pointer">
      {{ room.name }}
    </div>
    <div>{{ room.floor }}</div>
    <div>{{ room.room_class?.[0]?.name || "Kh√¥ng r√µ" }}</div>
    <div>{{ room.status?.[0]?.name || "Kh√¥ng r√µ" }}</div>
    <div>{{ room.room_class?.[0]?.bed_amount }}</div>
    <div>{{ room.room_class?.[0]?.price | currency : "VND" }}</div>
    <!-- <div>{{ room.room_class[0].description }}</div> -->
    <!-- <div>{{ getFeatureNames(room) }}</div> -->
    <div class="actions">
      <!-- Edit icon -->
      <button
        class="icon-button"
        (click)="onOpenPopup(false, room); $event.stopPropagation()"
      >
        <i class="fas fa-pen"></i>
      </button>
    </div>
  </div>
  <!-- Pagination -->
   <app-pagination
    [page]="filter.page"
    [total]="filter.total"
    [limit]="filter.limit"
    (pageChange)="onPageChange($event)"
   />
  <!-- popup chi ti·∫øt -->
  <div class="popup-overlay" *ngIf="isDetailPopupOpen && selectedRoom">
    <div class="popup-content">
      <h2>Chi ti·∫øt ph√≤ng: {{ selectedRoom.name }}</h2>

      <label>L·ªãch ƒë·∫∑t ph√≤ng:</label>
      <full-calendar [options]="calendarOptions"></full-calendar>

      <div class="popup-section">
        <label>T√™n ph√≤ng:</label>
        <span>{{ selectedRoom.name || "Kh√¥ng r√µ" }}</span>
      </div>

      <div class="popup-section">
        <label>T·∫ßng:</label>
        <span>{{ selectedRoom.floor }}</span>
      </div>

      <div class="popup-section">
        <label>Tr·∫°ng th√°i:</label>
        <span>{{ selectedRoom.status?.[0]?.name }}</span>
      </div>

      <div class="popup-section">
        <label>M√¥ t·∫£:</label>
        <span>{{ selectedRoom.room_class?.[0]?.description }}</span>
      </div>

      <div class="popup-section">
        <label>S·ªë gi∆∞·ªùng:</label>
        <span>{{ selectedRoom.room_class?.[0]?.bed_amount }}</span>
      </div>

      <div class="popup-section">
        <label>T√™n lo·∫°i ph√≤ng:</label>
        <span>{{ selectedRoom.room_class?.[0]?.name }}</span>
      </div>

      <div class="popup-section">
        <label>Gi√°:</label>
        <span>{{
          selectedRoom.room_class?.[0]?.price | currency : "VND" : "symbol"
        }}</span>
      </div>

      <div class="popup-section">
        <label>Gi√° gi·∫£m:</label>
        <span>{{
          selectedRoom.room_class?.[0]?.price_discount
            | currency : "VND" : "symbol"
        }}</span>
      </div>

      <div class="popup-section">
        <label>S·ª©c ch·ª©a:</label>
        <span>{{ selectedRoom.room_class?.[0]?.capacity }} ng∆∞·ªùi</span>
      </div>

      <button class="close-btn" (click)="onClosePopup()">ƒê√≥ng</button>
    </div>
  </div>

  <!-- popup s·ª≠a ph√≤ng -->
  <div class="popup-add-popup" *ngIf="isEditPopupOpen && selectedRoom">
    <div class="popup-content">
      <h2>S·ª≠a ph√≤ng</h2>

      <form #editForm="ngForm" (ngSubmit)="onEditSubmit()">
        <div class="popup-section">
          <div class="form-floating form-floating-custom mb-3">
            <input
              type="email"
              class="form-control"
              id="name"
              name="name"
              placeholder=""
              [(ngModel)]="selectedRoom.name"
              (ngModelChange)="selectedRoom.name = $event"
              required
            />
            <label for="name">T√™n lo·∫°i ph√≤ng ch√≠nh</label>
          </div>
        </div>

        <div class="popup-section">
          <div class="form-floating form-floating-custom mb-3">
            <input
              type="number"
              class="form-control"
              id="floor"
              name="floor"
              min="0"
              placeholder=""
              [(ngModel)]="selectedRoom.floor"
              (ngModelChange)="selectedRoom.floor = $event"
              required
            />
            <label for="floor">T·∫ßng</label>
          </div>
        </div>

        <div class="popup-section">
          <label for="room_class_id">Lo·∫°i ph√≤ng:</label>
          <select
            id="room_class_id"
            name="room_class_id"
            class="form-select form-control mb-3"
            [(ngModel)]="selectedRoom.room_class_id"
            (ngModelChange)="selectedRoom.room_class_id = $event"
            required
          >
            <option value="" disabled selected>Ch·ªçn lo·∫°i ph√≤ng</option>
            <option
              *ngFor="let roomClass of roomClasses"
              [value]="roomClass.id"
            >
              {{ roomClass.name }}
            </option>
          </select>
        </div>

        <div class="popup-actions">
          <button
            class="btn btn-success"
            type="submit"
            [disabled]="!editForm.form.valid"
          >
            L∆∞u
          </button>
          <button class="btn btn-danger" type="button" (click)="onClosePopup()">
            H·ªßy
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
